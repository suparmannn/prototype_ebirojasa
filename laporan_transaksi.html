<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Laporan Transaksi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #0A7EFF; --primary-blue-dark: #0056b3; --sidebar-bg: #1C2E46; --bg-light: #F8F9FA; --card-bg: #FFFFFF; --text-dark: #343A40; --text-medium: #6C757D; --text-light: #CED4DA; --border-color: #E9ECEF; --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.08); --shadow-input: 0 0 0 3px rgba(10, 126, 255, 0.1);
            --status-green: #15803D; --status-green-bg: #F0FDF4;
            --status-red: #D92D20; --status-red-bg: #FFF0F0;
        }
        body, html { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; background-color: var(--bg-light); height: 100%; overflow: hidden; color: var(--text-dark); }
        * { box-sizing: border-box; }
        .admin-layout { display: flex; height: 100vh; }
        .sidebar { width: 280px; background-color: var(--sidebar-bg); padding: 30px 0; display: flex; flex-direction: column; flex-shrink: 0; position: relative; z-index: 100; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .sidebar-logo { display: flex; align-items: center; justify-content: center; padding: 0 20px 30px; margin-bottom: 30px; border-bottom: 1px solid rgba(255, 255, 255, 0.08); }
        .sidebar-logo svg { height: 35px; margin-right: 12px; color: var(--primary-blue); filter: drop-shadow(0 0 5px rgba(10, 126, 255, 0.5)); }
        .sidebar-logo span { font-size: 1.6rem; font-weight: 700; color: #ffffff; letter-spacing: 0.5px; }
        .sidebar-nav { list-style: none; padding: 0; margin: 0; }
        .sidebar-nav li { margin-bottom: 8px; }
        .sidebar-nav a { display: flex; align-items: center; padding: 14px 30px; text-decoration: none; color: var(--text-light); font-weight: 500; font-size: 0.98rem; transition: all 0.3s ease; position: relative; }
        .sidebar-nav a i { margin-right: 18px; font-size: 1.1rem; width: 20px; text-align: center; }
        .sidebar-nav li.active a { background: linear-gradient(90deg, var(--primary-blue), rgba(10, 126, 255, 0.8)); color: #ffffff; border-radius: 0 50px 50px 0; box-shadow: 0 5px 15px rgba(10, 126, 255, 0.3); left: 0; }
        .sidebar-nav li:not(.active) a:hover { background-color: rgba(255, 255, 255, 0.08); color: #ffffff; border-radius: 0 50px 50px 0; }
        .main-content { flex-grow: 1; display: flex; flex-direction: column; padding: 30px; overflow-y: auto; }
        
        /* == PERUBAHAN CSS TOPBAR == */
        .topbar {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: flex-end; /* BERUBAH: Mendorong ke kanan */
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
            animation: fadeInDown 0.5s ease-out;
        }
        /* CSS .search-bar dan .topbar-title dihapus */
        
        .topbar-right { display: flex; align-items: center; gap: 25px; }
        .topbar-icon { color: var(--text-medium); font-size: 1.3rem; position: relative; cursor: pointer; transition: color 0.2s; }
        .topbar-icon:hover { color: var(--primary-blue); }
        .topbar-icon .badge { position: absolute; top: -8px; right: -10px; background-color: #F44336; color: white; font-size: 0.75rem; padding: 4px 7px; border-radius: 50%; line-height: 1; font-weight: 600; }
        .user-menu { display: flex; align-items: center; cursor: pointer; padding: 5px 10px; border-radius: 10px; transition: background-color 0.2s; }
        .user-menu:hover { background-color: var(--bg-light); }
        .user-menu img { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; border: 2px solid var(--border-color); object-fit: cover; }
        .user-menu span { font-weight: 600; color: var(--text-dark); margin-right: 10px; }
        .user-menu i { color: var(--text-medium); font-size: 0.9rem; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .btn { padding: 12px 25px; border: none; border-radius: 10px; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: all 0.3s ease; }
        .btn-secondary { background-color: var(--bg-light); color: var(--text-medium); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background-color: var(--border-color); }
        .btn-primary { background: linear-gradient(45deg, var(--primary-blue), #5e9eff); color: white; box-shadow: 0 5px 15px rgba(10, 126, 255, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(10, 126, 255, 0.4); }
        .btn-danger { background: #F44336; color: white; }
        .btn i { margin-right: 8px; }

        /* ================================== */
        /* == CSS UNTUK LAPORAN == */
        /* ================================== */
        .content-header-main { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; animation: fadeInUp 0.5s ease-out 0.2s forwards; opacity: 0; }
        .content-header-left h1 { font-size: 2rem; color: var(--text-dark); margin: 0; font-weight: 700; letter-spacing: -0.5px; }
        .content-header-right { display: flex; gap: 15px; }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 30px;
            animation: fadeInUp 0.5s ease-out 0.4s forwards;
            opacity: 0;
        }
        .summary-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
        }
        .summary-card span {
            font-size: 1rem;
            color: var(--text-medium);
            font-weight: 500;
        }
        .summary-card h2 {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin: 10px 0 0 0;
        }
        .summary-card.terhutang h2 {
            color: var(--status-red);
        }

        .filter-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            margin-bottom: 30px;
            animation: fadeInUp 0.5s ease-out 0.6s forwards;
            opacity: 0;
        }
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            align-items: flex-end;
        }
        .form-group { margin-bottom: 0; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-medium); }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            background-color: #ffffff; /* Input filter dibuat putih */
            transition: all 0.3s ease;
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
        }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-blue); box-shadow: var(--shadow-input); background-color: #ffffff; }

        .data-table-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: fadeInUp 0.5s ease-out 0.8s forwards;
            opacity: 0;
            flex-grow: 1;
        }
        .data-table-wrapper { flex-grow: 1; overflow-y: auto; margin-bottom: 25px; }
        .data-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 0.95rem; min-width: 900px; }
        .data-table th, .data-table td { padding: 18px 20px; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        .data-table th { background-color: var(--bg-light); font-weight: 600; color: var(--text-dark); position: sticky; top: 0; z-index: 1; }
        .data-table thead th:first-child { border-top-left-radius: 10px; }
        .data-table thead th:last-child { border-top-right-radius: 10px; }
        .data-table tbody tr:last-child td { border-bottom: none; }
        .data-table tbody tr:hover { background-color: #EBF5FF; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem; }
        .status-lunas { background-color: var(--status-green-bg); color: var(--status-green); }
        .status-terhutang { background-color: var(--status-red-bg); color: var(--status-red); }
        
        .action-icons { display: flex; align-items: center; gap: 10px; }
        .action-detail { color: var(--text-medium); font-size: 1.15rem; transition: color 0.2s, transform 0.2s; cursor: pointer; }
        .action-detail:hover { color: var(--primary-blue); transform: scale(1.1); }
        .btn-sm { padding: 6px 14px; font-size: 0.85rem; }
        
        .pagination { display: flex; justify-content: center; align-items: center; border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: auto; }
        .pagination a { text-decoration: none; color: var(--text-medium); padding: 8px 15px; font-weight: 500; }
        .pagination a.current-page { color: var(--primary-blue); }
        .pagination a:hover { color: var(--primary-blue); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--card-bg); padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); width: 90%; max-width: 500px; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .modal-header h2 { margin: 0; font-size: 1.5rem; color: var(--text-dark); font-weight: 600; }
        .modal-close-btn { background: none; border: none; font-size: 1.8rem; color: var(--text-medium); cursor: pointer; transition: color 0.2s; }
        .modal-close-btn:hover { color: var(--text-dark); }
        .modal-footer { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; }
        .detail-item { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 1rem; }
        .detail-item span:first-child { color: var(--text-medium); }
        .detail-item span:last-child { color: var(--text-dark); font-weight: 500; }
    </style>
</head>
<body>

    <div class="admin-layout">
        
        <aside class="sidebar">
            <div class="sidebar-logo">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue">
                    <path d="M4 17V8a2 2 0 0 1 2-2h8.5L20 10.5V20a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/><path d="M10 2v4"/><path d="M10 18v4"/><path d="M10 6h4"/><path d="M10 18h4"/><path d="M6 10h4"/><path d="M6 14h4"/>
                </svg>
                <span>E-Biro Jasa</span>
            </div>
            
            <ul class="sidebar-nav">
                <li><a href="#"><i class="fas fa-fw fa-tachometer-alt"></i><span>Dashboard Utama</span></a></li>
                <li><a href="index.html"><i class="fas fa-fw fa-money-check-alt"></i><span>Data Portal PKB</span></a></li>
                <li><a href="management_akun.html"><i class="fas fa-fw fa-users"></i><span>Management Akun</span></a></li>
                <li><a href="management_produk.html"><i class="fas fa-fw fa-box"></i><span>Management Produk</span></a></li>
                <li><a href="pos.html"><i class="fas fa-fw fa-cash-register"></i><span>POS</span></a></li>
                <li class="active"><a href="laporan_transaksi.html"><i class="fas fa-fw fa-chart-line"></i><span>Laporan Transaksi</span></a></li>
            </ul>
        </aside>

        <main class="main-content">
            
            <div class="topbar">
                <div class="topbar-right">
                    <a href="#" class="topbar-icon"> <i class="fas fa-bell"></i> <span class="badge">3</span> </a>
                    <div class="user-menu"> <img src="https://via.placeholder.com/40" alt="User Avatar"> <span>Admin</span> <i class="fas fa-chevron-down"></i> </div>
                </div>
            </div>

            <div class="content-header-main">
                <div class="content-header-left">
                    <h1 id="laporan-title">Laporan Transaksi</h1>
                </div>
                <div class="content-header-right">
                    <button class="btn btn-secondary" id="btn-print"><i class="fas fa-print"></i> Print Laporan</button>
                    <button class="btn btn-primary" id="btn-export"><i class="fas fa-file-excel"></i> Export Excel</button>
                </div>
            </div>

            <div class="summary-grid">
                <div class="summary-card">
                    <span>Total Transaksi</span>
                    <h2>Rp 3.050.000</h2>
                </div>
                <div class="summary-card">
                    <span>Total Profit</span>
                    <h2>Rp 1.400.000</h2>
                </div>
                <div class="summary-card terhutang">
                    <span>Total Terhutang</span>
                    <h2>Rp 250.000</h2>
                </div>
            </div>

            <div class="filter-card">
                <div class="filter-grid">
                    <div class="form-group">
                        <label for="filter-start-date">Start Date</label>
                        <input type="date" id="filter-start-date">
                    </div>
                    <div class="form-group">
                        <label for="filter-end-date">End Date</label>
                        <input type="date" id="filter-end-date">
                    </div>
                    <div class="form-group">
                        <label for="filter-no-pol">No. Polisi</label>
                        <input type="text" id="filter-no-pol" placeholder="B 1234 ABC">
                    </div>
                    <div class="form-group">
                        <label for="filter-nama">Nama Konsumen</label>
                        <input type="text" id="filter-nama" placeholder="Cari nama...">
                    </div>
                    <div class="form-group">
                        <label for="filter-status">Status Pembayaran</label>
                        <select id="filter-status">
                            <option value="all">Semua Status</option>
                            <option value="Lunas">Lunas</option>
                            <option value="Terhutang">Terhutang</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="data-table-card">
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tgl. Transaksi</th>
                                <th>Nama Konsumen</th>
                                <th>No. Pol</th>
                                <th>Produk Jasa</th>
                                <th>Total Biaya</th>
                                <th>Profit</th>
                                <th>Jml. Dibayarkan</th>
                                <th>Jml. Terhutang</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="report-table-body">
                            <tr data-status="Terhutang">
                                <td>2025-10-01</td>
                                <td>Budi Santoso</td>
                                <td>B 1234 ABC</td>
                                <td>Perpanjang STNK Mobil 5 Tahunan</td>
                                <td>Rp 2.250.000</td>
                                <td>Rp 750.000</td>
                                <td>Rp 2.000.000</td>
                                <td>Rp 250.000</td>
                                <td><span class="status-badge status-terhutang">Terhutang</span></td>
                                <td>
                                    <div class="action-icons">
                                        <a title="Detail" class="action-detail"><i class="fas fa-eye"></i></a>
                                        <button class="btn btn-primary btn-sm action-bayar">Bayar</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="Lunas">
                                <td>2025-10-05</td>
                                <td>Citra Lestari</td>
                                <td>D 4321 XYZ</td>
                                <td>BBN Motor (Baru)</td>
                                <td>Rp 800.000</td>
                                <td>Rp 500.000</td>
                                <td>Rp 800.000</td>
                                <td>Rp 0</td>
                                <td><span class="status-badge status-lunas">Lunas</span></td>
                                <td>
                                    <div class="action-icons">
                                        <a title="Detail" class="action-detail"><i class="fas fa-eye"></i></a>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="Lunas">
                                <td>2025-10-06</td>
                                <td>Rahmat Hidayat</td>
                                <td>-</td>
                                <td>Jasa Cek Fisik Bantuan</td>
                                <td>Rp 150.000</td>
                                <td>Rp 150.000</td>
                                <td>Rp 150.000</td>
                                <td>Rp 0</td>
                                <td><span class="status-badge status-lunas">Lunas</span></td>
                                <td>
                                    <div class="action-icons">
                                        <a title="Detail" class="action-detail"><i class="fas fa-eye"></i></a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination">
                    <a href="#">Previous</a>
                    <a href="#" class="current-page">1</a>
                    <a href="#">Next</a>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detail Transaksi</h2>
                <button class="modal-close-btn" data-target-modal="#detail-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-item"> <span>No. Transaksi</span> <span id="detail-no-transaksi">TRX1001</span> </div>
                <div class="detail-item"> <span>Tgl. Transaksi</span> <span id="detail-tgl">2025-10-01</span> </div>
                <div class="detail-item"> <span>Nama Konsumen</span> <span id="detail-nama">Budi Santoso</span> </div>
                <div class="detail-item"> <span>No. Polisi</span> <span id="detail-nopol">B 1234 ABC</span> </div>
                <hr style="border: none; border-top: 1px dashed var(--border-color); margin: 15px 0;">
                <div class="detail-item"> <span>Produk Jasa</span> <span id="detail-produk">Perpanjang STNK Mobil 5 Thn</span> </div>
                <div class="detail-item"> <span>Total Biaya</span> <span id="detail-total">Rp 2.250.000</span> </div>
                <div class="detail-item"> <span>Profit</span> <span id="detail-profit">Rp 750.000</span> </div>
                <div class="detail-item"> <span>Fee Dev</span> <span id="detail-fee-dev">Rp 75.000</span> </div>
                <hr style="border: none; border-top: 1px dashed var(--border-color); margin: 15px 0;">
                <div class="detail-item"> <span>Jml. Dibayarkan</span> <span id="detail-bayar">Rp 2.000.000</span> </div>
                <div class="detail-item"> <span>Jml. Terhutang</span> <span id="detail-hutang">Rp 250.000</span> </div>
                <div class="detail-item"> <span>Status</span> <span id="detail-status" style="font-weight: 700; color: var(--status-red);">Terhutang</span> </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close-btn" data-target-modal="#detail-modal">Tutup</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="bayar-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Bayar Hutang</h2>
                <button class="modal-close-btn" data-target-modal="#bayar-modal">&times;</button>
            </div>
            <form id="bayar-form">
                <div class="form-group">
                    <label>No. Polisi</label>
                    <input type="text" id="bayar-nopol" readonly style="background-color: var(--bg-light);">
                </div>
                <div class="form-group">
                    <label>Jumlah Terhutang</label>
                    <input type="text" id="bayar-hutang-sisa" readonly style="background-color: var(--bg-light); color: var(--status-red); font-weight: 700;">
                </div>
                <div class="form-group">
                    <label for="bayar-jumlah-bayar">Jumlah Pembayaran</label>
                    <input type="number" id="bayar-jumlah-bayar" placeholder="Masukkan jumlah pembayaran" required style="background-color: #ffffff;">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary modal-close-btn" data-target-modal="#bayar-modal">Batal</button>
                    <button type="submit" class="btn btn-primary">Konfirmasi Pembayaran</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const btnPrint = document.getElementById('btn-print');
            const btnExport = document.getElementById('btn-export');
            const reportTableBody = document.getElementById('report-table-body');
            const detailModal = document.getElementById('detail-modal');
            const detailStatus = document.getElementById('detail-status');
            const bayarModal = document.getElementById('bayar-modal');
            const bayarForm = document.getElementById('bayar-form');
            const bayarNopol = document.getElementById('bayar-nopol');
            const bayarHutangSisa = document.getElementById('bayar-hutang-sisa');
            const bayarJumlah = document.getElementById('bayar-jumlah-bayar');

            // --- ELEMEN JUDUL DINAMIS (BARU) ---
            const laporanTitle = document.getElementById('laporan-title');
            const filterStartDate = document.getElementById('filter-start-date');
            const filterEndDate = document.getElementById('filter-end-date');
            
            // --- Fungsi ---
            
            const showModal = (modalElement) => {
                modalElement.classList.add('show');
            };
            
            const hideModal = (modalElement) => {
                modalElement.classList.remove('show');
            };

            const addEventListenersToRow = (row) => {
                const detailBtn = row.querySelector('.action-detail');
                const bayarBtn = row.querySelector('.action-bayar');
                
                const rowData = {
                    tgl: row.cells[0].textContent,
                    nama: row.cells[1].textContent,
                    nopol: row.cells[2].textContent,
                    produk: row.cells[3].textContent,
                    total: row.cells[4].textContent,
                    profit: row.cells[5].textContent,
                    bayar: row.cells[6].textContent,
                    hutang: row.cells[7].textContent,
                    status: row.dataset.status
                };
                
                if (detailBtn) {
                    detailBtn.addEventListener('click', () => {
                        document.getElementById('detail-tgl').textContent = rowData.tgl;
                        document.getElementById('detail-nama').textContent = rowData.nama;
                        document.getElementById('detail-nopol').textContent = rowData.nopol;
                        document.getElementById('detail-produk').textContent = rowData.produk;
                        document.getElementById('detail-total').textContent = rowData.total;
                        document.getElementById('detail-profit').textContent = rowData.profit;
                        document.getElementById('detail-fee-dev').textContent = "Rp 75.000"; // Dummy
                        document.getElementById('detail-bayar').textContent = rowData.bayar;
                        document.getElementById('detail-hutang').textContent = rowData.hutang;
                        document.getElementById('detail-status').textContent = rowData.status;
                        
                        if (rowData.status === 'Terhutang') {
                            detailStatus.style.color = 'var(--status-red)';
                        } else {
                            detailStatus.style.color = 'var(--status-green)';
                        }
                        
                        showModal(detailModal);
                    });
                }
                
                if (bayarBtn) {
                    bayarBtn.addEventListener('click', () => {
                        bayarNopol.value = rowData.nopol;
                        bayarHutangSisa.value = rowData.hutang;
                        bayarJumlah.value = parseFloat(rowData.hutang.replace(/[^0-9]/g, ''));
                        showModal(bayarModal);
                    });
                }
            };

            // --- FUNGSI JUDUL DINAMIS (BARU) ---
            const updateReportTitle = () => {
                const start = filterStartDate.value;
                const end = filterEndDate.value;
                
                const formatDate = (dateString) => {
                    if (!dateString) return null;
                    const [y, m, d] = dateString.split('-');
                    return `${d}/${m}/${y}`;
                }

                const formattedStart = formatDate(start);
                const formattedEnd = formatDate(end);

                if (start && end) {
                    laporanTitle.textContent = `Laporan Transaksi Periode: ${formattedStart} s/d ${formattedEnd}`;
                } else if (start) {
                    laporanTitle.textContent = `Laporan Transaksi Periode: Mulai ${formattedStart}`;
                } else if (end) {
                    laporanTitle.textContent = `Laporan Transaksi Periode: Sampai ${formattedEnd}`;
                } else {
                    laporanTitle.textContent = 'Laporan Transaksi (Semua Periode)';
                }
            };
            
            // --- Event Listeners ---
            
            btnPrint.addEventListener('click', () => alert('Mencetak Laporan...'));
            btnExport.addEventListener('click', () => alert('Mengekspor Laporan ke Excel...'));
            
            document.querySelectorAll('.modal-close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const modal = document.querySelector(btn.dataset.targetModal);
                    hideModal(modal);
                });
            });
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        hideModal(overlay);
                    }
                });
            });

            bayarForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const dibayar = parseFloat(bayarJumlah.value);
                const sisaHutang = parseFloat(bayarHutangSisa.value.replace(/[^0-9]/g, ''));
                
                if (dibayar < sisaHutang) {
                    alert('Pembayaran kurang! Status masih Terhutang.');
                } else {
                    alert('Pembayaran Lunas! Transaksi ' + bayarNopol.value + ' telah lunas.');
                }
                hideModal(bayarModal);
            });
            
            reportTableBody.querySelectorAll('tr').forEach(row => {
                addEventListenersToRow(row);
            });

            // --- LISTENER JUDUL DINAMIS (BARU) ---
            filterStartDate.addEventListener('change', updateReportTitle);
            filterEndDate.addEventListener('change', updateReportTitle);
            
            // Panggil sekali saat load
            updateReportTitle();
            
        });
    </script>

</body>

</html>
